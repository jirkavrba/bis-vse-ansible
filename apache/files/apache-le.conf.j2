SSLStaplingCache shmcb:/tmp/stapling_cache(128000)

ServerAdmin {{ email }}
ServerName {{ server_host }}

<VirtualHost *:80>
    Redirect permanent / https://{{ server_host }}/
</VirtualHost>

<VirtualHost *:433>
    ErrorLog ${APACHE_LOG_DIR}/error.log
    CustomLog ${APACHE_LOG_DIR}/access.log combined

    Protocols h2 http/1.1

    SSLEngine on

    SSLCertificateFile /etc/letsencrypt/live/bis-ansible-1.vrba.dev/fullchain.pem
    SSLCertificateKeyFile /etc/letsencrypt/live/bis-ansible-1.vrba.dev/privkey.pem

    SSLUseStapling on

    # TODO: Security headers

    Include /etc/letsencrypt/options-ssl-apache.conf

    <Proxy *>
        Allow from all 
    </Proxy>


    ProxyPreserveHost On
    ProxyRequests Off

    ProxyPass / http://127.0.0.1:3000/
    ProxyPassReverse / http://127.0.0.1:3000/

    <Location /lam>
        ProxyPass http://127.0.0.1:4000/lam/
        ProxyPassReverse http://127.0.0.1:4000/lam/

        Order allow,deny
    
        # TODO: Limit access
    </Location>
</VirtualHost>